# リポジトリ運用ガイド (Agents Guidelines)

## 目的

本ガイドは当リポジトリにおける AI 支援生成物、コードレビュー、コミットメッセージ、およびドキュメント作成の統一方針を示すものである。

## 適用範囲

- コード本体
- ドキュメント（Markdown）
- Issue/Pull Request
- 自動生成補助（AI エージェント）

## 言語・文体

- ドキュメント・コメントは日本語とし、文体は「である調」に統一する。
- ユーザーへの回答は「ですます調」の日本語で行う。
- 英数字（ASCII）の語と日本語の間は、原則として半角スペースを入れる。

## 実行計画 (Exec Plan)

- 大きめの変更（移植、リファクタリング、性能改善、アルゴリズム追加など）は、
  `.agent/PLANS.md` のテンプレートに従い、作業開始時に
  実行計画（Exec Plan）を作成すること。
- `topic` は `kebab-case`（ASCII）を推奨する。
- 実行計画は `.agent/plans/<YYYY-MM-DD>_<topic>.md` に保存し、レビュー/議論の参照点として運用すること。
- 実行計画を作成する際は、実行計画を立案したブランチから `topic/<topic>` ブランチを派生し、
  その最初のコミットとして実行計画を追加すること。
- 作業ブランチごとに `Active` な実行計画は 1 つのみとする。
- 実行済み/中止の計画は `.agent/plans/archive/` へ移動し、`Status` を `Done` / `Canceled` としてクローズすること。
  起点ブランチへマージする時点で、実行計画は必ず `.agent/plans/archive/` に移動済みであること。
- 実行計画には少なくとも以下を含めること。
  - 背景/目的、範囲、非目標、受け入れ基準、検証手順、リスク/未確定事項、Progress（唯一のチェックリスト）
- 実行中に前提や方針が変わった場合は、実行計画を更新し、変更理由を記録すること。

## 戦略文書 (Strategy Document)

- プロジェクト全体の設計方針、ブレインストーミング成果物、技術選定の根拠などは、
  戦略文書として `.agent/strategy/<YYYY-MM-DD>_<topic>.md` に保存すること。
- 戦略文書は実行計画（Exec Plan）とは異なり、「1 ブランチ 1 計画」ルールの対象外とする。
  複数の実行計画から参照される上位の設計資料として扱う。
- 実行計画の `Related` フィールドから戦略文書を参照することを推奨する。

## 作業ログ (Work Log)

- 計画の実行中に発生した課題/問題/検証結果は `.agent/worklog/<YYYY-MM-DD>_<topic>.md` に記録すること。
- 作業ログからミーティング向け報告書へまとめる場合は、`.agent/WORKLOG.md` の推奨フォーマット（タグ付け）に従うこと。

## コミット・PR ガイドライン

- コミットメッセージは先頭に gitmoji を付与し、本文は日本語で簡潔に書く（文体は「である調」）。
- 構成は `<gitmoji> 簡潔な概要` を基本とし、必要に応じて空行の後に箇条書きで補足する。
- 例:

  ```text
  🐛 DEIMv2のメモリリークを修正

  - HISDF前処理をリファクタリング
  - 複数のコードのコメント修正
  ```

- PR は最小差分を徹底し、目的・変更ファイル・検証手順（実行コマンド/起動プロファイル）を簡潔に書く。

## Markdown の作成・編集ルール

- Markdown は markdownlint の一般的な規則（見出し構造、リスト、空行、コードブロック）に準拠する。
- 設定ファイル（`.markdownlint.json`、`.markdownlint-cli2.*` 等）が存在する場合は、それを正とする。
- Markdown ファイル末尾は改行 1 つのみとし、末尾に空行を複数入れない。
- lint が実行可能であれば最終確認として実行し、警告/エラーを解消する（例: `markdownlint-cli2 "**/*.md"`）。

## シェルスクリプトの作成・編集ルール

- シェルスクリプト（`*.sh`）は、可能な範囲で bash 互換を意識して記述する。
- `shellcheck` と `shfmt` が利用可能な場合は最終確認として実行し、書式と構文のチェックを行い警告/エラーを解消する。

## バッチファイル・シェルスクリプトにおける命名規則

- 内部変数はキャメルケースとする。
- 環境変数、外部変数、定数はアッパースネークケースとする。
- 関数名はパスカルケースとする。
