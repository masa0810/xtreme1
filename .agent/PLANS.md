# 実行計画 (Exec Plan) 運用ガイド

## 目的

本ドキュメントは、リポジトリ内での「実行計画（Exec Plan）」の書き方と運用ルールを
定義するものである。
実行計画は、コーディング前に方針と段取りを固定し、途中での変更も含めて意思決定を
追跡可能にするための最小限の設計文書である。

## 置き場所

- 実行計画のテンプレート: `.agent/PLANS.md`（本ファイル）
- 各タスクの実行計画: `.agent/plans/<YYYY-MM-DD>_<topic>.md`
- 実行済み/中止の実行計画: `.agent/plans/archive/<YYYY-MM-DD>_<topic>.md`

## いつ作るか

以下のいずれかに該当する場合、実行計画を作成すること。

- 変更が複数ファイルにまたがる
- 仕様の解釈や設計判断が必要である
- 既存実装の置換/移植/最適化で、回帰リスクが高い
- テストや性能評価の観点を先に固めたい

## 基本ルール

- 実行計画は「作業開始前」に作成し、「作業中に更新」するものである。
- `topic` は `kebab-case`（ASCII）を推奨する。
- 実行計画を作成する際は、実行計画を立案したブランチから `topic/<topic>` ブランチを派生し、
  その最初のコミットとして実行計画を追加すること。
- 作業ブランチごとに `Active` な実行計画は 1 つのみとする。
- 実行計画内のチェックリストは `Progress` にのみ置き、それ以外の節では
  チェックリストを用いないこと。
- ステップはレビュー可能な単位に分割し、1 ステップで 1 つの論点が閉じるように
  すること。
- 実行計画の更新時は、`Decisions / Changes` に「何を」「なぜ」変えたかを
  追記すること。

## ライフサイクル

- `Draft`: 着手前の草案（レビュー待ちを含む）
- `Active`: 実装/検証が進行中
- `Done`: 完了（受け入れ条件と検証が満たされた）
- `Canceled`: 中止/延期（再開する場合は新しい計画を作り直す）

`Done` または `Canceled` になった計画は、`.agent/plans/archive/` へ移動する。
起点ブランチへマージする時点で、実行計画は必ず `.agent/plans/archive/` に移動済みであること。

## 作業ログ (Work Log)

計画の実行中に発生した課題/問題/検証結果を、後から会議用の報告へ転用できる形で
残すため、詳細なログは計画ファイルとは別に保存する。

- 作業ログの置き場所: `.agent/worklog/<YYYY-MM-DD>_<topic>.md`
- 作業ログの運用ガイド: `.agent/WORKLOG.md`

計画ファイルは「意思決定と段取り」に寄せ、作業ログは「事実と観測」に寄せる。

## 実行計画テンプレート

以下を新規ファイルとして `.agent/plans/` 配下に作成して運用すること。

## Title: （例）TrackEval Python 実装の C++ 移植

## Metadata

- Owner:
- Created: YYYY-MM-DD
- Last updated: YYYY-MM-DD
- Status: Draft / Active / Done / Canceled
- Closed: YYYY-MM-DD（Status が Done / Canceled の場合）
- Related: Issue/PR/Docs/戦略文書（任意。例: `.agent/strategy/2026-02-18_distributed-mcas-design.md`）
- Work log: `.agent/worklog/<YYYY-MM-DD>_<topic>.md`（任意）

## Context

本タスクの背景、なぜ今必要か、利用者/利用箇所、成功時に得られる価値を
簡潔に記述する。

## Scope

In-scope:

- （例）HOTA/CLEAR/Identity/Count の移植
- （例）入力形式の統一（JSON 化など）

Out-of-scope（非目標）:

- （例）TrackEval 全データセット対応
- （例）学習コード/可視化ツールの追加

## Requirements

- 互換性: 何を「同等」とみなすか（数値誤差、NaN 扱い、丸め、例外条件など）
- I/O: 入力形式、型、境界条件（空配列、負 ID、重複 ID、異常値）
- 性能: 目標（例: 既存比○倍、上限レイテンシ、メモリ）
- 並列性/再現性: マルチスレッド時の決定性要件など

## Approach

移植方針を述べる（例: Python 参照実装を基準にし、テストで同等性を担保しながら
段階的に移植する）。
主要な設計判断（API、データ構造、依存関係、例外設計、数値計算の扱い）を列挙する。

## Risks / Unknowns

- 未確定事項、調査が必要な点、破壊的変更の可能性を列挙する。
- 回避策/緩和策（テスト、段階的導入、feature flag 等）を併記する。

## Plan

フェーズ単位で、成果物が明確な粒度で分割して記述する（箇条書きは可、
チェックボックスは不可）。

例:

- Phase 0: 参照実装の固定（対象コミット/バージョン、入出力仕様を確定）
- Phase 1: 入力データモデルの C++ 定義（境界条件を明文化）
- Phase 2: コアアルゴリズム移植（小さな関数から順に）
- Phase 3: 同等性テスト追加（Python 参照/サンプル JSON）
- Phase 4: 性能計測・最適化（必要なら）
- Phase 5: ドキュメント整備、API 確定

## Progress

唯一のチェックリストとし、タスクの進捗更新はここだけで行うこと。

- [ ] Phase 0: 参照実装の固定
- [ ] Phase 1: データモデル/API 確定
- [ ] Phase 2: 移植実装
- [ ] Phase 3: テストで同等性担保
- [ ] Phase 4: 性能評価（必要なら）
- [ ] Phase 5: ドキュメント/仕上げ

## Acceptance Criteria

完了条件を、観測可能な形で列挙する。

例:

- 代表ケースで Python 参照と一致（許容誤差: 1e-9 など）
- 境界条件（空入力など）で例外/戻り値が仕様通り
- ユニットテストが追加され、CI/ローカルで再現可能

## Verification

本リポジトリでの検証コマンドを記載する（環境依存の前提も併記する）。

## Rollback Plan

失敗時の戻し方（フラグで無効化、旧実装併存、切り戻し手順）を記述する。

## Decisions / Changes

- YYYY-MM-DD: （例）対象データセットを MOT17/MOT20 に限定した。理由: 検証データの
  準備負荷を下げるため。
